<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>答題遊戲</title>
    
    <style>
        #timer {
            position: absolute;
            top: 10px;
            right: 10px;
        }
        
    </style>
   
       
     <link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body>
    <!--背景音樂-->
    
    <audio id="backgroundMusic" controls autoplay loop>
            <source src="../template/audio/背景音樂.mp3">
    </audio>
    <script>
        const backgroundMusic = document.getElementById("backgroundMusic");
        
        // 頁面加載後播放音樂
        document.addEventListener("DOMContentLoaded", () => {
            backgroundMusic.play()
                .catch(error => {
                    //無法播放時
                    console.error("自动播放失败:", error);
                });
        });
    </script>
   
    <!--背景音樂end-->
    <!--正確音效-->
        <audio id="correctMusic" controls>
            <source src="../template/audio/答案正確.mp3">
        </audio>
    <!--正確音效end-->
    <!--錯誤音效-->
        <audio id="errorMusic" controls>
            <source src="../template/audio/答案錯誤.mp3">
        </audio>
    <!--錯誤音效end-->
    <!--開獎音效-->
        <audio id="answerMusic" controls>
            <source src="../template/audio/開獎結果.mp3">
        </audio>

    <!--開獎音效end-->
     <!--使用者登入次數-->
     <div id="counter">答題人數：0</div>
     <script>
        // 讀取 Local Storage 中的計數器值
        let counterValue = parseInt(localStorage.getItem('counterValue')) || 0;
        
        // 顯示計數器值
        const counterElement = document.getElementById('counter');
        counterElement.textContent = `答題人數：${counterValue}`;
    
        // 每次開啟網站時，將計數器值增加 1 並更新顯示
        counterValue++;
        counterElement.textContent = `答題人數：${counterValue}`;
    
        // 將更新後的計數器值寫入 Local Storage
        localStorage.setItem('counterValue', counterValue.toString());
     </script>
    
     <!--end-->
    
    <h1>反詐騙</h1>
    <div id="question-container" class="centered-container">

        
        <div id="question-text"></div>
            <div  class="main-container">
                <div id="ox">
                    <div  id="overlay">
                        <img class="overlay-item" id="overlay-image" src="../template/img/crrect.gif" alt="gif">
                    </div> 
                    <div  id="overlay">
                        <img class="overlay-item" id="overlay-image" src="../template/img/crrect.gif" alt="gif">
                    </div> 
                </div>
                <form id="answer-form">
                    <label> <input type="radio" name="answer" value="option1" ></label><br>
                    <label> <input type="radio" name="answer" value="option2" ></label><br>
                </form>  
            </div>
        <!--
        <button id="next-button">按Ｎ下一題</button>
        -->     
    </div>
   
    
    <script>
        let questionIndex = 0;
        let correctAnswers = 0; 
        
        const allQuestions = [
        //反詐騙題庫
        {
            question: "反詐騙諮詢專線為165",
            options: ["(A)是", "(B)非"],
            correctAnswer: 0
        },
        {
            question: "詐騙投資案常用的術語為保證獲利、低報酬率、投越多賺越多、穩賺不賠、強調低風險、高獎金等",
            options: ["(A)是", "(B)非"],
            correctAnswer: 1
        },
        {
            question: "提高警覺防詐騙，警民合作165，謹記「四要」原則避免落入詐騙陷阱",
            options: ["(A)是", "(B)非"],
            correctAnswer: 1
        },
        {
            question: "常見詐騙手法例如: 假投資、解除分期付款、假交友/戀愛、輕鬆純打字、高薪，免出門就能在家上班",
            options: ["(A)是", "(B)非"],
            correctAnswer: 0
        },
        {
            question: "165反詐騙專線是金管會提供的",
            options: ["(A)是", "(B)非"],
            correctAnswer: 1//
        },
        {
            question: "查詢謠言真假應該下載165反詐騙專線APP",
            options: ["(A)是", "(B)非"],
            correctAnswer: 0//
        },
        {
            question: "網路購物被詐騙無法透過165反詐騙 APP線上填寫報案",
            options: ["(A)是", "(B)非"],
            correctAnswer: 1//
        },
        {
            question: "165反詐騙APP有預製筆錄的功能",
            options: ["(A)是", "(B)非"],
            correctAnswer: 0
        },
        {
            question: "在165反詐騙APP預製筆錄完不需要到派出所完成報案",
            options: ["(A)是", "(B)非"],
            correctAnswer: 1
        },
        {
            question: "詐騙集團會偽裝成商家電話來進行詐騙",
            options: ["(A)是", "(B)非"],
            correctAnswer: 0
        },
       
    ];
    // 隨機選擇的題目索引
    const selectedQuestions = [];
    while (selectedQuestions.length < 6) {
        const randomIndex = Math.floor(Math.random() * allQuestions.length);
        if (!selectedQuestions.includes(randomIndex)) {
            selectedQuestions.push(randomIndex);
        }
    }

    const questions = selectedQuestions.map(index => allQuestions[index]);
     // 隨機生成一個題目索引
    function getRandomIndex() {
        return Math.floor(Math.random() * allQuestions.length);
    }

        let questionNumber = 1; // 題目初始值
        displayQuestion(questionIndex);
     
        //問題項目
        function displayQuestion(index) {
           
           const questionContainer = document.getElementById("question-container");
           const questionText = document.getElementById("question-text");
           const answerForm = document.getElementById("answer-form");
           const options = questions[index].options;
           //問題
           questionText.textContent = `Q:${questions[index].question}`; // 題號

           const optionLabels = answerForm.querySelectorAll("label");
           optionLabels.forEach((label, i) => {
               label.innerHTML = `<input type="radio" name="answer" value="option${i + 1}">${options[i]}`;
           });
       }

       
        //問題項目end
    
        
            function initGame() {
                //紅圈圈讀取 0,1
                let correctIndex = 9999;
                const overlayItems = document.querySelectorAll(".overlay-item");
                //let currentAnswer =4;
                let keyDown =4;
                //監聽按鈕
                document.addEventListener('keydown', function(event) {
                    const key = event.key.toLowerCase();
                  
                    if (key === 'a' || key === 'b' ) {
                        let option = 'option1';
                        switch (key) {
                            case 'a':
                                option = 'option1';
                                keyDown =0;
                                correctIndex = questions[questionIndex].correctAnswer;
                                
                                break;
                            case 'b':
                                option = 'option2';
                                keyDown =1;
                                correctIndex = questions[questionIndex].correctAnswer;
                                
                                break;
                           
                            default:
                                option = 'option0';
                                break;
                        }
                        //按下的答案
                        const selectedOption = document.querySelector(`[value="${option}"]`);
                    
                        if (selectedOption) {
                            
                            selectedOption.checked = true;
                            //顯示紅圈圈
                            overlayItems[ correctIndex ].style.visibility= "visible";   
                            //按下音效
                            //當前選擇按鈕＝>currentAnswer
                            const soundEffect1 = document.getElementById("correctMusic");
                            const soundEffect2 = document.getElementById("errorMusic");
                            
                                
                                if (correctIndex === keyDown ) {
                                    correctAnswers++;
                                    soundEffect1.play();
                                } else {
                                    soundEffect2.play();
                                }
                             // 延遲一秒跳轉
                            setTimeout(() => {
                               
                                if(correctAnswers === 1){
                                    window.location.href = "ＴＭ.html";
                                }
                                //消紅圈圈
                                overlayItems[ correctIndex ].style.visibility= "hidden";  
                                //下一題功能
                                const selectedAnswer = document.querySelector('input[name="answer"]:checked');
                                if (selectedAnswer) {
                                    const selectedValue = selectedAnswer.value;
                                    const correctIndex = questions[questionIndex].correctAnswer;
                                    questionIndex++;
                                    if (questionIndex < questions.length) {
                                        displayQuestion(questionIndex);
                                    } else {
                                        endGame();
                                    }

                                    // 清除选中的答案
                                    selectedAnswer.checked = false;
                                }
                            }, 1000);
                        
                                                            
                                        }
                    }

                    if (event.key === "s" ) {
                       
                        window.location.href = "index.html";
                    }
                });

                
               
            }

        initGame();

      
   
    </script>
</body>
</html>
